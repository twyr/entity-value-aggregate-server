<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>JSDoc: Source: lib/error-serializer.js</title>
		<script src="scripts/prettify/prettify.js"> </script>
		<script src="scripts/prettify/lang-css.js"> </script>
		<!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
		<link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
		<link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
	</head>

	<body>
		<div id="main">
			<h1 class="page-title">Source: lib/error-serializer.js</h1>
			<section>
				<article>
					<pre class="prettyprint source linenums"><code>/**
 * Imports for this file
 * @ignore
 */

/**
 * @async
 * @function errorSerializer
 *
 * @param {Error} [error] - Error Object to be serialized
 *
 * @returns {object} - serialized error object
 *
 * @description
 * Recursively serializes an error till it reaches the leaf nodes.
 * Leaf nodes are defined as errors that are:
 * - Not AggregateError objects
 * - Do not contain a `cause`
 * - Have a `cause` that is not an Error object
 */
const errorSerializer = function errorSerializer(error) {
	let printFullStack = true;
	const serializedError = {
		message: error?.message,
		location: error?.stack?.split?.('\n')?.[1]?.trim?.()
	};

	if (error instanceof AggregateError) {
		printFullStack = printFullStack &amp;&amp; false;
		serializedError['errors'] = [];
		for (const subError of error?.errors ?? []) {
			serializedError?.['errors']?.push?.(errorSerializer?.(subError));
		}
	}

	if (error?.cause) {
		printFullStack = printFullStack &amp;&amp; false;

		if (error.cause instanceof Error) {
			serializedError['cause'] = errorSerializer?.(error.cause);
		} else {
			printFullStack = printFullStack &amp;&amp; true;
			serializedError['cause'] = JSON?.stringify?.(
				error.cause,
				undefined,
				'\t'
			);
		}
	}

	for (const customProperty in error) {
		if (!error?.hasOwn?.(customProperty)) continue;
		if (customProperty === 'cause') continue;
		if (customProperty === 'errors') continue;

		if (customProperty instanceof Error) {
			printFullStack = printFullStack &amp;&amp; false;

			// eslint-disable-next-line security/detect-object-injection
			serializedError[customProperty] = errorSerializer?.(
				// eslint-disable-next-line security/detect-object-injection
				error?.[customProperty]
			);
		} else {
			// eslint-disable-next-line security/detect-object-injection
			serializedError[customProperty] = JSON?.stringify?.(
				// eslint-disable-next-line security/detect-object-injection
				error?.[customProperty],
				undefined,
				'\t'
			);
		}
	}

	if (printFullStack) {
		const stackArray = error?.stack
			?.split?.('\n')
			?.map?.((stackLocation) => {
				return stackLocation?.trim?.();
			});

		// The first line is redundant...
		stackArray?.shift?.();
		serializedError['stack'] = stackArray;
	}

	return serializedError;
};

const createErrorForPropagation = function createErrorForPropagation(
	message,
	errors
) {
	let propagatedError;

	if (!Array?.isArray?.(errors)) {
		errors = [errors];
	}

	if (errors?.length === 0) {
		propagatedError = new Error(message);
	}

	if (errors?.length === 1) {
		propagatedError = errors[0]
			? new Error(message, {
					cause: errors?.pop?.()
				})
			: new Error(message);
	}

	if (errors?.length > 1) {
		propagatedError = new AggregateError(errors, message);
	}

	return propagatedError;
};

export { createErrorForPropagation, errorSerializer };
</code></pre>
				</article>
			</section>
		</div>
		<nav>
			<h2><a href="index.html">Home</a></h2>
			<h3>Global</h3>
			<ul>
				<li><a href="global.html#errorSerializer">errorSerializer</a></li>
			</ul>
		</nav>
		<br class="clear">
		<footer>
			Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a>
		</footer>
		<script>
			prettyPrint();

		</script>
		<script src="scripts/linenumber.js"> </script>
	</body>

</html>
